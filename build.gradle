description = 'Email microservice for tempvs'
group = 'club.tempvs.email'
version = '1.0-SNAPSHOT'
apply plugin: 'java'
sourceCompatibility = 1.8

repositories {
    mavenCentral()
}


buildscript {
    repositories {
        jcenter()
    }
}

apply plugin: 'war'

dependencies {
    implementation "org.glassfish.jersey:jersey-bom:$jerseyVersion"
    //jersey
    compile "org.glassfish.jersey.containers:jersey-container-servlet:$jerseyVersion"
    compile "org.glassfish.jersey.inject:jersey-hk2:$jerseyVersion"
    //json
    compile "org.glassfish.jersey.media:jersey-media-json-jackson:$jerseyVersion"
    //email
    compile 'javax.mail:mail:1.4.7'
    compile 'javax.activation:activation:1.1.1'
    //heroku
    compile 'com.github.jsimone:webapp-runner:8.5.27.0'
    //testing
    testCompile "org.glassfish.jersey.test-framework.providers:jersey-test-framework-provider-bundle:$jerseyVersion"
    testCompile 'org.mockito:mockito-core:2.18.3'
}

task stage() {
    dependsOn clean, war
}

tasks.stage.doLast() {
    delete fileTree(dir: "build/distributions")
    delete fileTree(dir: "build/assetCompile")
    delete fileTree(dir: "build/distributions")
    delete fileTree(dir: "build/libs", exclude: "*.war")
}

war.mustRunAfter clean

task copyToLib(type: Copy) {
    into "$buildDir/server"
    from(configurations.compile) {
        include "webapp-runner*"
    }
}

stage.dependsOn(copyToLib)
